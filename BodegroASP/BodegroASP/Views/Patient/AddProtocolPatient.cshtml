@using BodegroASP.Models
@model BodegroASP.Models.AddProtocolPatientViewModel

<div class="container">
    <!-- Patient Information Card -->
    <div class="patient-card">
        <h2>Patient Information</h2>
        <p><strong>Name:</strong> @Model.Patient.Name</p>
        <p><strong>Email:</strong> @Model.Patient.Email</p>
        <p><strong>Phone:</strong> @Model.Patient.PhoneNumber</p>
        <p><strong>Medical History:</strong> @Model.Patient.MedicalHistory</p>
    </div>

    <!-- Protocols List -->
    <div class="subscriptions">
        <h2>Available Protocols</h2>
        <ul>
            @foreach (var protocol in Model.Protocols)
            {
                <li class="subscription-item">
                    <p><strong>Protocol Name:</strong> @protocol.Name</p>
                    <p><strong>Description:</strong> @protocol.Description</p>
                    <button type="button" class="add-protocol" onclick="selectProtocol(@Html.Raw(Json.Serialize(protocol)))">
                        Add
                    </button>
                </li>
            }
        </ul>
    </div>

    <!-- Protocol Linking Section -->
    <div id="protocol-linking-section" class="hidden">
        <h2>Link Protocol to Patient</h2>
        <div class="selected-details">
            <!-- Patient Info -->
            <div class="selected-patient">
                <h3>Patient</h3>
                <p><strong>Name:</strong> <span id="selected-patient-name"></span></p>
                <p><strong>Email:</strong> <span id="selected-patient-email"></span></p>
            </div>

            <!-- Protocol Info -->
            <div class="selected-subscription">
                <h3>Protocol</h3>
                <p><strong>Protocol Name:</strong> <span id="selected-protocol-name"></span></p>
                <p><strong>Description:</strong> <span id="selected-protocol-description"></span></p>
            </div>
        </div>

        <!-- Link Button -->
        <button type="button" id="link-protocol-button" onclick="linkProtocol()">Deze protocol koppelen aan patient <span id="patient-name-placeholder"></span></button>
    </div>
</div>

<script>
    let selectedPatient = @Html.Raw(Json.Serialize(Model.Patient)); // Fixed the reference here
    let selectedProtocol = null;

    // Function to populate the protocol linking section
    function selectProtocol(protocol) {
        selectedProtocol = protocol;

        // Populate patient and protocol details
        document.getElementById('selected-patient-name').innerText = selectedPatient.Name;
        document.getElementById('selected-patient-email').innerText = selectedPatient.Email;

        document.getElementById('selected-protocol-name').innerText = protocol.Name;
        document.getElementById('selected-protocol-description').innerText = protocol.Description;

        document.getElementById('patient-name-placeholder').innerText = selectedPatient.Name;

        // Show the protocol linking section
        document.getElementById('protocol-linking-section').classList.remove('hidden');
    }

    // Function to handle linking protocol to patient
    function linkProtocol() {
        if (selectedPatient && selectedProtocol) {
            // Replace the URL and add logic to send data to your backend
            fetch('/LinkProtocolToPatient', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    patient: selectedPatient,
                    protocol: selectedProtocol
                })
            }).then(response => {
                if (response.ok) {
                    alert('Protocol linked successfully!');
                    window.location.href = '/Index';
                } else {
                    alert('Failed to link protocol');
                }
            }).catch(error => {
                console.error('Error linking protocol:', error);
                alert('An error occurred.');
            });
        }
    }
</script>

<style>
    .container {
        max-width: 800px;
        margin: 0 auto;
        font-family: Arial, sans-serif;
    }

    .patient-card, .subscriptions, #protocol-linking-section {
        margin-bottom: 2rem;
        padding: 1rem;
        border: 1px solid #ccc;
        border-radius: 8px;
        background-color: #f9f9f9;
    }

    .hidden {
        display: none;
    }

    ul {
        list-style-type: none;
        padding: 0;
    }

    .subscription-item {
        margin-bottom: 1rem;
        padding: 0.5rem;
        border: 1px solid #ddd;
        border-radius: 6px;
        background-color: #fff;
    }

    .add-protocol {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        cursor: pointer;
    }

        .add-protocol:hover {
            background-color: #0056b3;
        }

    #link-protocol-button {
        background-color: #28a745;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        cursor: pointer;
    }

        #link-protocol-button:hover {
            background-color: #218838;
        }
</style>
